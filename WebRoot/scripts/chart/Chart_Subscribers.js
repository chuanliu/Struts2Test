/**var jsondata = {
		"channel" : "/service/exec",
		"clientId" : "9gfechm6l8byh106damfjg1lp4",
		"data" : {
			"BUSINESS_DATA" : {
				"grid" : {
					"columnHeader" : "[[\"0fe639a3-9bcc-4dc9-818d-21ce7c95cf21\",\"Year1\"],[\"400fec84-551c-4160-b08d-0809729cadbd\",\"Year2\"]]",
					"data" : "[[[\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"fef16f1f-ddbc-4b33-8a32-cf4733ce7710\",\"0fe639a3-9bcc-4dc9-818d-21ce7c95cf21\",1],[\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"fef16f1f-ddbc-4b33-8a32-cf4733ce7710\",\"400fec84-551c-4160-b08d-0809729cadbd\",1]],[[\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"c5540e30-cdda-4ee4-aa94-d2911cb49078\",\"0fe639a3-9bcc-4dc9-818d-21ce7c95cf21\",1],[\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"c5540e30-cdda-4ee4-aa94-d2911cb49078\",\"400fec84-551c-4160-b08d-0809729cadbd\",1]],[[\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"2a1cc937-d79f-4fba-8e44-2c215fb8ecb2\",\"0fe639a3-9bcc-4dc9-818d-21ce7c95cf21\",1],[\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"2a1cc937-d79f-4fba-8e44-2c215fb8ecb2\",\"400fec84-551c-4160-b08d-0809729cadbd\",1]],[[\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"3c6ba178-f028-43a2-ba32-e01fdca67a82\",\"0fe639a3-9bcc-4dc9-818d-21ce7c95cf21\",1],[\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"3c6ba178-f028-43a2-ba32-e01fdca67a82\",\"400fec84-551c-4160-b08d-0809729cadbd\",1]],[[\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"b09747da-e2fe-46e4-be96-b951fb5be83b\",\"0fe639a3-9bcc-4dc9-818d-21ce7c95cf21\",1],[\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"e345744d-b96d-46b9-95c7-b08fa8229a0b\",\"b09747da-e2fe-46e4-be96-b951fb5be83b\",\"400fec84-551c-4160-b08d-0809729cadbd\",1]],[[\"\",3.0],[\"\",3.0]],[[\"\",2.0],[\"\",2.0]]]",
					"rowHeader" : "[[\"fef16f1f-ddbc-4b33-8a32-cf4733ce7710\",\"01-Data\",\"Handsets\"],[\"c5540e30-cdda-4ee4-aa94-d2911cb49078\",\"01-Data\",\"MWB\"],[\"2a1cc937-d79f-4fba-8e44-2c215fb8ecb2\",\"01-Data\",\"FWB\"],[\"3c6ba178-f028-43a2-ba32-e01fdca67a82\",\"02-Voice\",\"MWV\"],[\"b09747da-e2fe-46e4-be96-b951fb5be83b\",\"02-Voice\",\"FWV\"],[\"0\",\"03-Total\",\"Broadband\"],[\"1\",\"03-Total\",\"Voice\"]]"
				},
				"rawData" : {
					"columnHeader" : [
							[ "0fe639a3-9bcc-4dc9-818d-21ce7c95cf21", "Year1" ],
							[ "400fec84-551c-4160-b08d-0809729cadbd", "Year2" ] ],
					"data" : [
							[
									[
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"fef16f1f-ddbc-4b33-8a32-cf4733ce7710",
											"0fe639a3-9bcc-4dc9-818d-21ce7c95cf21",
											1 ],
									[
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"fef16f1f-ddbc-4b33-8a32-cf4733ce7710",
											"400fec84-551c-4160-b08d-0809729cadbd",
											2 ] ],
							[
									[
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"c5540e30-cdda-4ee4-aa94-d2911cb49078",
											"0fe639a3-9bcc-4dc9-818d-21ce7c95cf21",
											3 ],
									[
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"c5540e30-cdda-4ee4-aa94-d2911cb49078",
											"400fec84-551c-4160-b08d-0809729cadbd",
											4 ] ],
							[
									[
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"2a1cc937-d79f-4fba-8e44-2c215fb8ecb2",
											"0fe639a3-9bcc-4dc9-818d-21ce7c95cf21",
											5 ],
									[
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"2a1cc937-d79f-4fba-8e44-2c215fb8ecb2",
											"400fec84-551c-4160-b08d-0809729cadbd",
											6 ] ],
							[
									[
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"3c6ba178-f028-43a2-ba32-e01fdca67a82",
											"0fe639a3-9bcc-4dc9-818d-21ce7c95cf21",
											7 ],
									[
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"3c6ba178-f028-43a2-ba32-e01fdca67a82",
											"400fec84-551c-4160-b08d-0809729cadbd",
											8 ] ],
							[
									[
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"b09747da-e2fe-46e4-be96-b951fb5be83b",
											"0fe639a3-9bcc-4dc9-818d-21ce7c95cf21",
											9 ],
									[
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"e345744d-b96d-46b9-95c7-b08fa8229a0b",
											"b09747da-e2fe-46e4-be96-b951fb5be83b",
											"400fec84-551c-4160-b08d-0809729cadbd",
											10 ] ],
							[ [ "", 1.0 ], [ "", 2.0 ] ],
							[ [ "", 5.0 ], [ "", 4.0 ] ] ],
					"rowHeader" : [
							[ "fef16f1f-ddbc-4b33-8a32-cf4733ce7710",
									"01-Data", "Handsets" ],
							[ "c5540e30-cdda-4ee4-aa94-d2911cb49078",
									"01-Data", "MWB" ],
							[ "2a1cc937-d79f-4fba-8e44-2c215fb8ecb2",
									"01-Data", "FWB" ],
							[ "3c6ba178-f028-43a2-ba32-e01fdca67a82",
									"02-Voice", "MWV" ],
							[ "b09747da-e2fe-46e4-be96-b951fb5be83b",
									"02-Voice", "FWV" ],
							[ "0", "03-Total", "Broadband" ],
							[ "1", "03-Total", "Voice" ] ]
				}
			},
			"COMMAND" : "COMMAND_QUERY_GRID",
			"MODULE_TYPE" : "MOD_REPORT",
			"STATUS" : "success",
			"edit" : false,
			"planningCycleId" : "c456daaf-c71f-4a71-bd45-bc3ba718946a",
			"renderCmp" : "centerBottomTabSixId51cfb4cc-b330-432d-a403-b7ef227519b7",
			"scenarioId" : "51cfb4cc-b330-432d-a403-b7ef227519b7",
			"showNavigation" : false,
			"siteGroupId" : "bd11c4a2-c273-418a-a0aa-153c980af330",
			"siteGroupPlannedId" : "f6549846-a4b1-4014-bbc5-fd86b3fe6c5a",
			"technologyId" : "71fa62a2-beb2-4561-8d9e-f6545ce4292a",
			"versionId" : "e345744d-b96d-46b9-95c7-b08fa8229a0b"
		},
		"id" : "127"
	};*/
	
//var Chart_SubscribersJsonData;
var divcolection = ["MOD_REPORT_ID","MOD_REPORT_OPEX_ID","MOD_REPORT_INCOME_ID","MOD_REPORT_EXPENSE_ID","MOD_REPORT_RECHARGE_ID"];
//调用方法设置参数Chart_Subscribers(data,obj_details_tbar_id);
	function Chart_Subscribers(jsondata,divId){
		this.divid = divId;
		this.jsondata = jsondata;
		var SubscribersDiv = divId;
		//Chart_SubscribersJsonData = jsondata;
		var div = d3.select("body").select("#"+divId);
		div.selectAll(".svg").remove();
		var Subscribers_svg = div.append("svg")
		   .attr("class"," svg Subscribers_svg"+divId)
	       .attr("width", width + margin.left + margin.right)
	       .attr("height", height + margin.top + margin.bottom)
		   .append("g")
	       .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
	       SubcribersFirstChart(jsondata,SubscribersDiv,Subscribers_svg);
  		//alert(window.onresize);
  		SubscribersWindow = function (){
  			if(document.documentElement.clientWidth>1000){
  			
				width = document.documentElement.clientWidth -365 - margin.left - margin.right;
				height = 250 - margin.top - margin.bottom;
				Subscribersx0 = d3.scale.ordinal()
				    .rangeRoundBands([0, width-370], .1);
				Subscribersx1 = d3.scale.ordinal();
				Subscribersy = d3.scale.linear()
					.range([height, 0]);
				SubscribersxAxis = d3.svg.axis()
				    .scale(Subscribersx0)
				    .orient("bottom");
				SubscribersyAxis = d3.svg.axis()
				    .scale(Subscribersy)
				    .orient("left")
					.tickFormat(d3.format(".2s")); 
				d3.selectAll(".Subscribers_svg"+SubscribersDiv)
					.remove();
				div = d3.select("body").select("#"+SubscribersDiv);
				Subscribers_svg = div.append("svg")
					.attr("class","svg Subscribers_svg"+divId)
			       .attr("width", width + margin.left + margin.right)
			       .attr("height", height + margin.top + margin.bottom)
				   .append("g")
			       .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
				SubcribersFirstChart(jsondata,SubscribersDiv,Subscribers_svg);
	  				
  			}
  	 };
  		
		
	}
	
	
//	function Redow_Chart_Subscribers(jsondata,divId){
//		var SubscribersDiv = divId;
//		var div = d3.select("body").select("#"+divId);
////		if(!div){
////			return;
////		}
//		div.selectAll(".svg").remove();
//		var Subscribers_svg = div.append("svg")
//		   .attr("class","Subscribers_svg"+divId+" svg")
//	       .attr("width", width + margin.left + margin.right)
//	       .attr("height", height + margin.top + margin.bottom)
//		   .append("g")
//	       .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
//  		//alert(window.onresize);
//  		SubscribersWindowRedow = function (){
//  			if(document.documentElement.clientWidth>1000){
//				width = document.documentElement.clientWidth -365 - margin.left - margin.right;
//				height = 250 - margin.top - margin.bottom;
//				Subscribersx0 = d3.scale.ordinal()
//	       			.rangeRoundBands([0, width-370], .1);
//				SubscribersxAxis = d3.svg.axis()
//			       .scale(Subscribersx0)
//			       .orient("bottom");
//		       //for(var i = 0;i<divcolection.length;i++){
//			       	d3.selectAll(".Subscribers_svg"+divId)
//						.remove();
//					div = d3.select("body").select("#"+divId)
//					Subscribers_svg = div.append("svg")
//						.attr("class","Subscribers_svg"+divId)
//				       .attr("width", width + margin.left + margin.right)
//				       .attr("height", height + margin.top + margin.bottom)
//					   .append("g")
//				       .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
//					SubcribersFirstChart(jsondata,SubscribersDiv,Subscribers_svg);
//		      // }
//				/*d3.selectAll(".Subscribers_svg"+divId)
//					.remove();
//				div = d3.select("body").select("#"+divId)
//				Subscribers_svg = div.append("svg")
//					.attr("class","Subscribers_svg"+divId)
//			       .attr("width", width + margin.left + margin.right)
//			       .attr("height", height + margin.top + margin.bottom)
//				   .append("g")
//			       .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
//				SubcribersFirstChart(Chart_SubscribersJsonData,SubscribersDiv,Subscribers_svg);*/
//	  				
//  			}
//  	 };
//  		SubcribersFirstChart(jsondata,SubscribersDiv,Subscribers_svg);
//		
//	}
		
  /* function getsun(js){
   	   datasun=[];
   	   for ( var t = 0; t < js.length; t++) {
   		   
   		   sundata=js[t].time;
   		   sundata["Totadata"]="year"+(t+1);
   		datasun.push(sundata);
   	   }
   	   
   		   console.log("jsons",datasun);  
   		   return datasun;
   };
   
   

function traverse(jsond) {
	for ( var i = 0; i < jsond.length; i++) {
		for ( var j = 0; j < jsond[i].length; j++) {
			jsond1.push(jsond[i][j]);
		}
	}
	return jsond1;
}
*/
/*function typedata(jsondata) {
	jsontotal = [];
	var jsond = jsondata.BUSINESS_DATA.rawData.data;
	var columnHeader = eval(jsondata.BUSINESS_DATA.grid.columnHeader);
	var rowHeader = eval(jsondata.BUSINESS_DATA.grid.rowHeader);
	var newdata = traverse(jsond);
	console.log(newdata);
	for ( var j = 0; j < columnHeader.length; j++) {
		var option = {};
		var tTime={};
		var tValue = {};
		for ( var i = 0; i < newdata.length; i++) {
			for ( var l = 2; l < newdata[i].length; l++) {
				if (newdata[i][l] == columnHeader[j][0]) {
					option["Totadata"] = columnHeader[j][1];
					//for ( var g = 0; g < newdata.length; g++) {
						for ( var k = 0; k < rowHeader.length-2; k++) {
								if (newdata[i][2] == rowHeader[k][0]) {
									//alert(rowHeader[k][2]+":"+newdata[i][4]);
									//循环向ttt中添加元素，最后把ttt赋值给option的broadband元素
									tValue[rowHeader[k][2]] = newdata[i][4];
									//console.log("ttt",tValue);
									//alert(ttt);
									//option["broadband"] = ttt;
									continue;
								}
						}
					//}
					continue;
				}
			}
			option["broadband"] = tValue;
		}
		if(j==0){
			tTime[rowHeader[rowHeader.length-2][2]]=newdata[newdata.length-4][1];
			
			tTime[rowHeader[rowHeader.length-1][2]]=newdata[newdata.length-2][1];
			option["time"]=tTime;
			
		}else if(j==1){
			tTime[rowHeader[rowHeader.length-2][2]]=newdata[newdata.length-3][1];
			tTime[rowHeader[rowHeader.length-1][2]]=newdata[newdata.length-1][1];
			option["time"]=tTime;
		}
		jsontotal.push(option);
		console.log("diyigejsondata",jsontotal);
	}
	return jsontotal;
}
*/
function getAlldata(jsondata){
	var jsontotal = [];
	var data = jsondata.BUSINESS_DATA.rawData.data;
	var columnHeader = jsondata.BUSINESS_DATA.rawData.columnHeader;
	var rowHeader = jsondata.BUSINESS_DATA.rawData.rowHeader;
	for ( var i = 0; i < columnHeader.length; i++) {
		var TotalOption = {};
		TotalOption["Totadata"] = columnHeader[i][1];
		for ( var j = rowHeader.length-2; j < rowHeader.length; j++) {
			if(data && data[j] && data[j][i] && data[j][i][1]){
				TotalOption[rowHeader[j][2]] = data[j][i][1];
			}else{
				TotalOption[rowHeader[j][2]] = 0;
			}
		}
		jsontotal.push(TotalOption);
	}
	return jsontotal;
}
function getSubscribersData(jsondata){
	var TimeType = [];
	var data = jsondata.BUSINESS_DATA.rawData.data;
	var columnHeader = jsondata.BUSINESS_DATA.rawData.columnHeader;
	var rowHeader = jsondata.BUSINESS_DATA.rawData.rowHeader;
	for(var i=0;i<columnHeader.length;i++){
		var DataType = {};
		DataType["Totadata"] = columnHeader[i][1];
		for(var j = 0;j<rowHeader.length-2;j++){
			DataType[trim(rowHeader[j][2])] = data[j][i][4];
			
		}
		TimeType.push(DataType);
	}
	return TimeType;
}
function typedata(jsondata) {
	var jsontotal = [];
	var data = jsondata.BUSINESS_DATA.rawData.data;
	var columnHeader = jsondata.BUSINESS_DATA.rawData.columnHeader;
	var rowHeader = jsondata.BUSINESS_DATA.rawData.rowHeader;
	for ( var i = 0; i < columnHeader.length; i++) {
		var types={};
		var TotalOption = {};
		TotalOption["Totadata"] = columnHeader[i][1];
		for ( var j = 0; j < rowHeader.length; j++) {
			for ( var k = 0; k < data.length; k++) {
				if(rowHeader[j][0]==data[k][i][2]){
					types[rowHeader[j][2]]=data[k][i][4];
					
				}
			}
		}
		TotalOption["type"] = types;
		jsontotal.push(TotalOption);
	}
	return jsontotal;
}
function SubcribersFirstChart(jsondata,divId,Subscribers_svg){
	d3.selectAll(".Subscribers_svg"+divId)
		.attr("width",document.documentElement.clientWidth -365);
  // var jsonq = typedata(jsondata);
	var data=getAlldata(jsondata);
	var rowHeader = d3.keys(data[0]).filter(function(key) { return key !== "Totadata"; });
	var totalinfo=[];
	data.forEach(function(d) {
	 	d.information =rowHeader.map(function(name) { 
	 	 
   	    return {name:name,value:+d[name]};
	     });
	  });
	Subscribersx0.domain(data.map(function(d) { return d.Totadata; }));
	//x2.domain(totalinfo.map(function(d) { return d.value; }));
	Subscribersx1.domain(rowHeader).rangeRoundBands([0, Subscribersx0.rangeBand()]);
	Subscribersy.domain([0, d3.max(data, function(d) {
		  return d3.max(d.information, function(d) { 
		  return d.value*1.2; }); 
		 	 })
		  ]);
	Subscribers_svg.selectAll(".axis,.legend")
		.remove();
	Subscribers_svg.selectAll(".bar")
		.transition()
		.duration(1000)
		.attr("x",Subscribersx0.rangeBand()/2)
		.attr("width",0)
		.attr("y",height)
		.attr("height",0)
		.style("fill","#fff")
		.remove();
	Subscribers_svg.selectAll("g")
		.transition()
		.duration(1000)
		.remove();
	Subscribers_svg.append("g")
		.attr("class", "Subsx axis")
		.attr("transform", "translate(0, 0)")
		.attr("transform", "translate(0," + height + ")")
		.call(SubscribersxAxis);
	Subscribers_svg.append("g")
		.attr("class", "Subscribersy axis")
		.call(SubscribersyAxis)
		.append("text")
		.attr("transform", "rotate(-90)")
		.attr("y", 6)
		.attr("dy", "0.71em")
		.style("text-anchor", "end")
		.text("Qty");
	var state = Subscribers_svg.selectAll(".Totadata")
		.data(data)
		.enter().append("g")
		.attr("class", "g")
		.on("click",function(d){redraw(jsondata,divId,Subscribers_svg);})
		
		.attr("transform", function(d) { return "translate(" + Subscribersx0(d.Totadata) + ",0)"; });
	
	state.selectAll("rect")
		.data(function(d) { return d.information; })
		.enter().append("rect")
		.on("mouseover",function(d){Mytooltip(d.value);})
		.attr("title",function(d){return d.value})
		.attr("class","bar")
		.style("fill", function(d) { return color(d.name); })
		//.transition()
		//.duration(1000)
		.attr("x", function(d,i) { return Subscribersx1(d.name); })
		.attr("y", function(d) { return height; })
		.attr("x", Subscribersx0.rangeBand()/2)
		.transition()
		.duration(1000)
		.attr("x", function(d,i) { return Subscribersx1(d.name); })
		.attr("width", Subscribersx1.rangeBand())
		.attr("y", function(d) { return Subscribersy(d.value); })
		.attr("height", function(d) { return height - Subscribersy(d.value); })
		 ;
	
	var legend = Subscribers_svg.selectAll(".legend")
		.data(rowHeader.slice().reverse())
		.enter().append("g")
		.attr("class", "legend")
		//.attr("transform", function(d, i) { return "translate(10," + i * 20 + ")"; })
		;//右上角显示的数据位置
	
	legend.append("rect")
		.attr("x", width - 178)
		.attr("y", 0)
		.transition()
		.duration(1000)
		.attr("y",function(d, i) { return i * 20 ; })
		.attr("width", 18)
		.attr("height", 18)
		.style("fill", color);
	
	legend.append("text")
		.attr("x", width - 184)
		.attr("y", 9)
		.attr("dy", 0)
		.transition()
		.duration(1000)
		.attr("dy",function(d, i) { return i * 20+5 ; })
		//.attr("dy", ".35em")
		.style("text-anchor", "end")
		.text(function(d) { return d; });

  	
}
   
function redraw(jsondata,divId,Subscribers_svg) {
	//var jsonqq = typedata(jsondata);
	d3.selectAll(".Subscribers_svg"+divId).attr("width",document.documentElement.clientWidth -365);
	var data = getSubscribersData(jsondata);
	var rowHeaderq = d3.keys(data[0]).filter(function(key) { return key !== "Totadata"; });
	data.forEach(function(d){
		d.information = rowHeaderq.map(function(name){
		  		
			return {name:name,value:d[name]};
		 });
	 });
	// var totalinfosvar = d3.keys(totalinfos[0]).filter(function(key) { return key !== "Totadata"&&key!=="time"; });
	Subscribersx0.domain(data.map(function(d) { return d.Totadata; }));
	Subscribersx1.domain(rowHeaderq).rangeRoundBands([0, Subscribersx0.rangeBand()]);
	Subscribersy.domain([0, d3.max(data, function(d) {
		return d3.max(d.information, function(d) { 
			return d.value; }); 
		})
	]);
		  
	
	SubscribersxAxis = d3.svg.axis()
		.scale(Subscribersx0)
		.orient("bottom");
	
	SubscribersyAxis = d3.svg.axis()
		.scale(Subscribersy)
		.orient("left")
		.tickFormat(d3.format(".2s")); 
	Subscribers_svg.selectAll(".axis,.legend")
		.remove();
	Subscribers_svg.selectAll(".bar")
		.transition()
		.duration(1000)
		.attr("x",Subscribersx0.rangeBand()/2)
		.attr("width",0)
		.attr("y",height)
		.attr("height",0)
		.style("fill","#fff")
		.remove();
	Subscribers_svg.selectAll("g")
		.transition()
		.duration(1000)
		.remove();
	Subscribers_svg.append("g")
		.attr("class", "x axis")
		.attr("transform", "translate(0," + height + ")")
		.call(SubscribersxAxis);
	Subscribers_svg.append("g")
		.attr("class", "Subscribersy axis")
		.call(SubscribersyAxis)
		.append("text")
		.attr("transform", "rotate(-90)")
		.attr("y", 6)
		.attr("dy", ".71em")
		.style("text-anchor", "end")
		.text("Qty");
	state = Subscribers_svg.selectAll(".Totadata")
		.data(data)
		.enter().append("g")
		.attr("class", "g")
		.attr("transform", function(d) { return "translate(" + Subscribersx0(d.Totadata) + ",0)"; });
	
	/*  state.selectAll("rect")
	      .data(function(d) { return d.information; })
	    .enter().append("rect")
	    //.attr("width", 0)
	      .on("click",function(){SubcribersFirstChart(jsondata);})
	      
	      .attr("y", function(d) { return Subscribersy(d.value); })
	      .style("fill", function(d) { return color(d.name); })
	      .attr("height", function(d) { return height - Subscribersy(d.value); })
	      .attr("x", Subscribersx0.rangeBand()/2)
	      .transition()
	      .duration(1000)
	      .attr("x", function(d,i) { return Subscribersx1.rangeBand()/5*i; })
	    .attr("width", Subscribersx1.rangeBand()/5)
	      ;*/
	state.selectAll("rect")
		.data(function(d) { return d.information; })
		.enter().append("rect")
		.attr("class","bar")
		.attr("title",function(d){return d.value;})
		.on("click",function(){SubcribersFirstChart(jsondata,divId,Subscribers_svg);})
		.attr("y", function(d) { return height; })
		//.attr("height", function(d) { return height - Subscribersy(d.value); })
		.style("fill", function(d) { return color(d.name); })
		.attr("x",Subscribersx0.rangeBand()/2)
		.transition()
		.duration(1000)
		.attr("x", function(d) { return Subscribersx1(d.name); })
		.attr("width", Subscribersx1.rangeBand())
		.attr("y", function(d) { return Subscribersy(d.value); })
		.attr("height", function(d) { return height - Subscribersy(d.value); })
		;
		
	legend = Subscribers_svg.selectAll(".legend")
		.data(rowHeaderq.slice().reverse())
		.enter().append("g")
		.attr("class", "legend")
		//.attr("transform", function(d, i) { return "translate(10," + i * 20 + ")"; })
		;//右上角显示的数据位置
	
	legend.append("rect")
		.attr("x", width - 178)
		.attr("y", 0)
		.transition()
		.duration(1000)
		.attr("y",function(d, i) { return i * 20 ; })
		.attr("width", 18)
		.attr("height", 18)
		.style("fill", color);
	
	legend.append("text")
	
		.attr("x", width - 184)
		.attr("y", 9)
		.attr("dy", 0)
		.transition()
		.duration(1000)
		.attr("dy",function(d, i) { return i * 20+5 ; })
		//.attr("dy", ".35em")
		.style("text-anchor", "end")
		.text(function(d) { return d; });
}